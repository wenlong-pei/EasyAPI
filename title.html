<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>标题生成</title>
    <link rel="stylesheet" href="assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="assets/module/admin.css?v=315"/>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
			.layui-form-item {
				margin-bottom: 0;
				margin-top: 10px;
			}

			.layui-form-item .layui-inline {
				margin-bottom: 15px;
				margin-right: 0;
			}


    </style>
</head>

<body>

<!-- 加载动画 -->
<div class="page-loading">
    <div class="ball-loader">
        <span></span><span></span><span></span><span></span>
    </div>
</div>

<form class="layui-form" id="formAdvForm" lay-filter="formAdvForm">
    <div class="layui-fluid">
        <div class="layui-card">
            <div class="layui-card-header">SmartVA</div>
            <div class="layui-card-body">
                <div class="layui-container" style="margin: 0;width: 100%;">
                    <div class="layui-row">
                        <div class="layui-col-md6">
                            <div class="layui-form-item">
                                <label class="layui-form-label">代码(c/c++)<span style="color: red">*</span> </label>
                                <div class="layui-input-block" style="border: 1px solid;">
                                    <label for="code_1"></label>
                                    <textarea id="code_1" required="required" readonly="readonly" ></textarea>
                                </div>
                                <div class="layui-input-block" style="float:right; padding-top: 30px">
                                    <button class="layui-btn" lay-filter="formAdvSubmit" lay-submit>&emsp;生成&emsp;</button>
                                    <button type="reset" class="layui-btn layui-btn-primary">&emsp;重置&emsp;</button>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md6">
                            <div class="layui-form-item">
                                <label class="layui-form-label">预测结果</label>
                                <div class="layui-input-block" id="predict">
<!--                                    <textarea id="code" required="required" class="layui-textarea"-->
<!--                                              style="height: 304px;"></textarea>-->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item" style="padding-bottom: 40px">

                    </div>
                    <div class="layui-row">
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs4">
                            <div class="layui-card">
                                <div class="layui-card-header">漏洞分类结果</div>
                                <div class="layui-card-body">
                                    <div class="layui-field-box" style="height: 185px;" id = "classfication">
<!--                                        <div class="layui-input-block" style="border: 1px solid;">-->
<!--                                            <label for="title_1"></label><textarea id="title_1" required="required" readonly="readonly" ></textarea>-->
<!--                                        </div>-->
                                        <br>
<!--                                        <label class="layui-form-label">推荐标题2：</label>-->
<!--                                        <div class="layui-input-block">-->
<!--                                            <input type="text" style="width:80%; display: inline-block;" id="title_2" autocomplete="off" class="layui-input">-->
<!--                                            <a id="btn_2" target="_blank">-->
<!--                                                <button type="button" class="layui-btn-sm layui-btn">&emsp;查询&emsp;</button>-->
<!--                                            </a>-->
<!--                                        </div>-->
<!--                                        <br>-->
<!--                                        <label class="layui-form-label">推荐标题3：</label>-->
<!--                                        <div class="layui-input-block">-->
<!--                                            <input type="text" style="width:80%; display: inline-block;" id="title_3" autocomplete="off" class="layui-input">-->
<!--                                            <a id="btn_3" target="_blank">-->
<!--                                                <button type="button" class="layui-btn-sm layui-btn">&emsp;查询&emsp;</button>-->
<!--                                            </a>-->
<!--                                        </div>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs4">
                            <div class="layui-card">
                                <div class="layui-card-header">严重程度分析</div>
                                <div class="layui-card-body" style="">
                                    <div class="layui-field-box" style="height: 185px;" id = "assessment">

                                    </div>
<!--                                    <div class="layui-input-block" style="height: 200px;text-align:center;font-size: 30px;vertical-align:center;border:solid black 1px">-->
<!--                                    </div>-->
                                </div>

                            </div>

                        </div>
                        <div class="layui-col-md4 layui-col-sm4 layui-col-xs4">
                            <div class="layui-card">
                                <div class="layui-card-header">时间成本分析</div>
                                <div class="layui-card-body" style="">
                                     <div class="layui-field-box" style="height: 185px;" id="time">

                                    </div>
<!--                                    <div class="layui-input-block" style="height: 200px;text-align:center;font-size: 30px;vertical-align:center;border:solid black 1px" id="time">-->
<!--                                    </div>-->
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</form>


<!-- js部分 -->
<script type="text/javascript" src="assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="assets/js/common.js?v=315"></script>
<!-- js部分 -->
<script src="assets/libs/echarts/echarts.min.js"></script>
<script src="assets/libs/echarts/echartsTheme.js"></script>
<link rel="stylesheet" href="codemirror/lib/codemirror.css">
<script type="text/javascript" src="codemirror/lib/codemirror.js"></script>
<script type="text/javascript" src="codemirror/clike.js"></script>
<!--括号匹配-->
<script type="text/javascript" src="codemirror/addon/edit/matchbrackets.js"></script>

<!--自动补全-->
<link rel="stylesheet" href="codemirror/addon/hint/show-hint.css">
<script type="text/javascript" src="codemirror/addon/hint/show-hint.js"></script>
<script type="text/javascript" src="codemirror/addon/hint/anyword-hint.js"></script>
<!--引入css文件，用以支持主题-->
<link rel="stylesheet" href="codemirror/theme/idea.css">
<script>
			layui.use(['layer', 'form', 'table', 'laydate'], function() {
				var $ = layui.jquery;
				var layer = layui.layer;
				var form = layui.form;
				var table = layui.table;
				var laydate = layui.laydate;
                // var myCharts_2 = echarts.init(document.getElementById('bt'), myEchartsTheme);
				var editor = CodeMirror.fromTextArea(document.getElementById("code_1"), {
					//Java高亮显示
					mode: "text/x-csrc",
					//显示行号
					lineNumbers: true,
					//设置主题
					theme: "default",
					indentUnit: 4, // 缩进单位为4
					styleActiveLine: true, // 当前行背景高亮
					matchBrackets: true, // 括号匹配
					lineWrapping: true, // 自动换行
				});

				/* 监听表单提交 */
				form.on('submit(formAdvSubmit)', function(data) {
					data.field.content = editor.getValue();
						$.ajax({
							url: 'http://127.0.0.1:5000/smartVA',
							data: {
								'code': $("#code").val(),
								'desc': $("#desc").val()
							},
							type: 'get',
							beforeSend: function(){
                                   index_wait = layer.load(0, {  //发送请求前调用load方法
                                       shade: [0.5, '#fff'],  //0.5透明度的白色背景
                                    });
                             },
							success: function(res) {
							    layer.close(index_wait);
								console.log(res)
                                array = res.title_1
                                code = $("#code").val()
                                var result = array.toString().split(',').map(function(str) {
                                    return str.trim().replace(/ /g, '.');
                                }).join(', ');
                                console.log(result);
                                res_arr = result.split(',')
                                console.log(res_arr)
                                res_arr = res_arr.map(function(item) {
                                    return item.replace(/\s+/g, ""); // 删除每个元素中的空格
                                });
								$("#time").html('<br>'+'耗时' + res.time + '秒')
								// $("#btn_1").attr("href", "https://www.baidu.com/s?wd="+res.title_1)
								editor.setValue(code+'.'+res_arr[0]);
								for ( var i = 1;i<res_arr.length;i++){
								    editor.setValue(editor.getValue()+'\n'+code+'.'+res_arr[i]);
                                }

							},
							error: function(e) {
								layer.msg('请检查代码是否正确！禁止输入行内注释');
							}
						})

					return false;
				});

			});



</script>
</body>

</html>